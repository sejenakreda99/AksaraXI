
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Users collection:
    // - Authenticated users can read their own data.
    // - Authenticated users can update their own data.
    // - Gurus can read and write any user document.
    match /users/{userId} {
      allow read, update, delete: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null;
      allow list, read, write: if request.auth != null && request.auth.token.role == 'Guru';
    }

    // Groups collection:
    // - Gurus can manage groups.
    match /groups/{groupId} {
      allow read, write, create, delete: if request.auth != null && request.auth.token.role == 'Guru';
    }

    // Chapters collection:
    // - Any authenticated user (student or teacher) can read chapter content.
    // - Only teachers can write/update chapter content.
    match /chapters/{chapterId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.token.role == 'Guru';
    }

    // Submissions collection:
    // - Students can create and update their own submissions.
    // - Teachers can read any submission for grading.
    match /submissions/{submissionId} {
      allow read, write: if request.auth != null && request.auth.uid == resource.data.studentId;
      allow read: if request.auth != null && request.auth.token.role == 'Guru';
    }
  }
}
